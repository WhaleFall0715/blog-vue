---
title: 如何实现VUE到Docker服务器一键部署
date: 2025-08-18
category:
  - 学习博客
tag:
  - 学习文档
  - 工作流
  - 自动化部署
sticky: false
---

<!-- more -->

# 如何使用 VUE Press+Jenkins+Docker 实现一键部署到服务器的博客网站

## 1.Docker 与 Nginx 配置

​ 在服务器安装 Docker 时，要注意修改镜像网站，修改指令如下

```cmd
#进入路径
sudo nano /etc/docker/daemon.json
#配置镜像
{
  "registry-mirrors": ["https://docker.mirrors.ustc.edu.cn"],
  "insecure-registries": ["my-private-registry:5000"],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m",
    "max-file": "3"
  },
  "data-root": "/mnt/docker-data",
  "default-ulimits": {
    "nofile": {
      "Name": "nofile",
      "Hard": 65536,
      "Soft": 65536
    }
  }
}
#重启Docker
sudo systemctl restart docker  # Linux
```

​ 否则在安装时，就算可以安装 docker，也无法下载 Nginx 依赖

​ 安装 Nginx 依赖

```cmd
# 1. 更新系统包
sudo apt update && sudo apt upgrade -y

# 2. 安装依赖
sudo apt install -y apt-transport-https ca-certificates curl software-properties-common

# 3. 添加Docker官方GPG密钥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

# 4. 添加Docker仓库
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 5. 安装Docker引擎
sudo apt update && sudo apt install -y docker-ce docker-ce-cli containerd.io

# 6. 验证安装（出现"Hello from Docker!"即成功）
sudo docker run hello-world

# 7. 拉取Nginx依赖
docker pull nginx

```

​ 将 Nginx 拉取后就可以编写 Dockerfile 实现自动化部署，例如下述

```cmd
#Dockerfile
#设定Nginx版本
FROM nginx:alpine
#拷贝路径到Nginx路径下
COPY ./dist /usr/share/nginx/html
#拷贝Nginx配置
COPY ./nginx.conf /etc/nginx/conf.d/default.conf
#设定端口
EXPOSE 80
```

​ 然后再编写部署脚本，实现一键执行部署

```cmd
#Deploy.sh
# 进入项目目录
cd /home/shared

# 1. 停止并移除旧容器（如果存在）
docker stop my-site 2>/dev/null || true
docker rm my-site 2>/dev/null || true

# 2. 重新构建镜像，使用当前文件夹的dockerfile
docker build -t static-site .

# 3. 运行新容器
docker run -d --name my-site -p 80:80 static-site

# 4. 清理无用镜像（可选）
docker image prune -f 2>/dev/null

echo "✅ 部署完成！容器已启动。"

```

​ 编写完成上述脚本，就可以实现 deploy.sh->清除旧容器->复制工作目录->构建镜像->运行容器部署，的过程，下面就开始介绍如何将压缩包自动解压并且部署

## 2.Jenkins 实现自动解压压缩包和执行脚本

​ 在服务器上安装 Jenkins，并且下载基础插件：汉化、流水线等功能

​ 在工作中，新建流水线项目，取名后就可以编写解压缩脚本以及执行脚本

```yaml
pipeline {
    agent any
    triggers {
        pollSCM('H/2 * * * *')  // 每分钟检查一次（比 cron 更高效）
    }
    stages {
        stage('Check & Execute') {
            steps {
                script {
                    if (fileExists('/home/shared/dist.zip')) {
                        echo "发现 dist.zip，开始处理..."
                        sh '''
                            cd /home/shared
                            echo "开始解压..."
                            unzip -o dist.zip -d dist/ || true
                            echo "解压完成"
                            chmod +x deploy.sh
                            ./deploy.sh 2>&1 | tee deploy.log
                            rm -f dist.zip     # 删除原压缩包
                        '''
                    }else echo "未发现dist.zip"
                }
            }
        }
    }
}
```

​ 然后执行这个脚本就可以全自动的执行解压 dist.zip 然后部署

​ 在执行时，有时候会出现 PermissionDenied，这时候是因为 Jenkins 没有当前文件夹的读写权限，需要在当前文件夹的用户组中加入 Jenkins。

```cmd
sudo chown -R :jenkins /home/shared  # 修改所属组
sudo chmod -R g+rwx /home/shared    # 赋予组读写执行权限
#使用
ls -ld /home/shared
#应该输出下述
drwxrwxr-x 2 root jenkins 4096 Jan 1 12:34 /home/shared
```

​ 此时，Jenkins 就拥有对当前文件夹的权限了

## 3.实现远程调用 JenkinsAPI 执行自动部署脚本

​ 在配置完 Jenkins 之后，要想实现全自动部署，需要在远程使用脚本调用 JenkinsAPI，这样才可以实现全自动的部署。

​ 先要在 Jenkins 权限中设置都可以访问

![image-20250818152343581](https://gitee.com/dufei_handsome/mypic/raw/master/20250818152345.png)

​ 授权中指定任何用户都可以使用，也可以在请求的 header 中塞入 token 或者用户密码来实现有权限的访问。下一步要设定工作流的访问权限

![image-20250818152449152](https://gitee.com/dufei_handsome/mypic/raw/master/20250818152450.png) 在工作流中勾选触发远程构建，然后输入 Token 令牌，实现远程调用。下一步编写远程脚本进行调用。在 windows 中，使用 ps1 文件编写脚本。

```cmd
#DEPLOY.ps1
# 上传 ZIP 文件到服务器
scp -i $env:USERPROFILE\.ssh\id_ed25519 .\dist.zip ubuntu@SERVICE_IP:/home/shared/

# 触发 Jenkins 任务
$jenkinsBaseUrl = "http://SERVICE_IP:8080"
$jenkinsUrl = "http://SERVICE_IP:8080/job/blog-watcher/build"
$buildToken = "AUTO_DEPLOY"
$user = "admin"
$apiToken = "用户Token"

$auth = [Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes("${user}:${apiToken}"))
$headers = @{
    Authorization = "Basic $auth"
}
Invoke-WebRequest -Uri "${jenkinsUrl}?token=${buildToken}" `
    -Method POST -Headers $headers -UseBasicParsing

# 按 Enter 键关闭窗口
Write-Host "一键打包发送部署完成，我真牛逼！"
```

​ 脚本第一步是实现拷贝 zip 到服务器，需要创建私钥进行访问，直接参考 windows 怎么创建私钥即可，下述的使用方法，一定要使用 base64 加密塞进 header，这样可以实现权限访问，下面为用户 token 创建过程：右上角点击用户，进入 Security 创建新 token。

![image-20250818153217371](https://gitee.com/dufei_handsome/mypic/raw/master/20250818153218.png)

​

## 4.VUE Press 实现自动打包+部署

​ 在 Package.json 中编写如下脚本

```json
"docs:build": "vuepress-webpack build src && npm run compress && npm run deploy",
"docs:clean-dev": "vuepress-webpack dev src --clean-cache",
"docs:dev": "vuepress-webpack dev src",
"docs:update-package": "npx vp-update",
"compress": "cd src/.vuepress && jar -cvf dist.zip -C dist .",
"deploy": "cd src/.vuepress && powershell -ExecutionPolicy Bypass -File SEND.ps1"
```

​ 使用 jar 打包，可以防止正斜杠和反斜杠的兼容问题。执行 pnpm run docs:build 可以实现全自动对项目进行打包部署。
